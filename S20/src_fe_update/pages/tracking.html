<!doctype html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>S2O - Theo d√µi ƒë∆°n h√†ng</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css"/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet"/>

  <style>
    :root {
      --primary: #e85d04;
      --success: #2e8b57;
      --gray: #adb5bd;
      --bg: #f8f9fa;
    }
    body { font-family: "Inter", sans-serif; background-color: var(--bg); padding-bottom: 80px; }

    /* HEADER */
    .sticky-header {
      position: sticky; top: 0; z-index: 1020; background: white;
      padding: 15px 0; box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
    }

    /* TABS */
    .order-tabs { display: flex; background: white; border-bottom: 1px solid #eee; overflow-x: auto; }
    .order-tab {
      flex: 1; padding: 15px; border: none; background: none;
      font-weight: 600; color: #666; border-bottom: 3px solid transparent;
      white-space: nowrap; cursor: pointer;
    }
    .order-tab.active { color: var(--primary); border-bottom-color: var(--primary); }

    /* CARDS */
    .order-card {
      background: white; border-radius: 12px; margin-bottom: 16px;
      border: none; box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05); overflow: hidden;
    }
    .order-header {
      padding: 12px 15px; border-bottom: 1px solid #f8f9fa;
      display: flex; justify-content: space-between; align-items: center;
    }
    .status-badge {
      padding: 5px 10px; border-radius: 6px; font-size: 0.75rem; font-weight: 700; text-transform: uppercase;
    }

    /* PROGRESS BAR */
    .progress-track {
      display: flex; justify-content: space-between; position: relative; margin: 20px 10px 10px;
    }
    .progress-bg {
      position: absolute; top: 12px; left: 0; width: 100%; height: 4px;
      background: #eee; z-index: 1; border-radius: 2px;
    }
    .progress-fill {
      position: absolute; top: 12px; left: 0; height: 4px;
      background: var(--primary); z-index: 1; transition: 0.5s; border-radius: 2px;
    }
    .step { position: relative; z-index: 2; text-align: center; width: 25%; }
    .step-icon {
      width: 28px; height: 28px; background: #eee; border-radius: 50%;
      margin: 0 auto 6px; display: flex; align-items: center; justify-content: center;
      color: #adb5bd; border: 3px solid white; font-size: 0.8rem;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
    }
    .step.active .step-icon {
      background: var(--primary); color: white;
      box-shadow: 0 0 0 3px rgba(232, 93, 4, 0.2);
    }
    .step.completed .step-icon { background: var(--success); color: white; }
    .step-label { font-size: 0.65rem; color: #999; font-weight: 500; }
    .step.active .step-label { color: var(--primary); font-weight: 700; }

    /* BOOKING SPECIFIC */
    .booking-info-row {
      display: flex; gap: 15px; margin-bottom: 8px; font-size: 0.9rem; color: #555;
    }
    .booking-info-row i { color: var(--primary); width: 20px; text-align: center; }

    /* RECEIPT MODAL */
    .bill-receipt {
      font-family: 'Courier New', Courier, monospace; background: #fff;
      padding: 15px; color: #000; font-size: 0.9rem; border: 1px solid #eee;
    }
    .bill-row { display: flex; justify-content: space-between; margin-bottom: 4px; }
    .bill-divider { border-top: 2px dashed #000; margin: 10px 0; }

    /* NAV */
    .bottom-nav {
      position: fixed; bottom: 0; left: 0; right: 0;
      background: white; padding: 10px 0; border-top: 1px solid #eee; z-index: 1030;
    }
    .nav-link-custom { text-align: center; color: #999; text-decoration: none; flex: 1; display: block; }
    .nav-link-custom.active { color: var(--primary); }
    .nav-link-custom i { font-size: 1.4rem; }
    .nav-link-custom span { font-size: 0.7rem; display: block; font-weight: 500; }
  </style>
</head>
<body>

<header class="sticky-header">
  <div class="container">
    <h1 class="h6 mb-0 fw-bold text-center text-uppercase ls-1">Qu·∫£n l√Ω ƒë∆°n h√†ng</h1>
  </div>
</header>

<div class="order-tabs" id="mainTabs">
  <button id="tab-SHIP" class="order-tab active" onclick="App.filter('SHIP', this)">
    <i class="bi bi-truck"></i> Giao h√†ng
  </button>
  <button id="tab-TABLE" class="order-tab" onclick="App.filter('TABLE', this)">
    <i class="bi bi-shop"></i> T·∫°i b√†n / ƒê·∫∑t ch·ªó
  </button>
  <button id="tab-HISTORY" class="order-tab" onclick="App.filter('HISTORY', this)">
    <i class="bi bi-clock-history"></i> L·ªãch s·ª≠
  </button>
</div>

<main class="container mt-3" id="ordersContainer">
  <div class="text-center py-5 text-muted">
    <div class="spinner-border spinner-border-sm text-warning" role="status"></div>
    <div class="mt-2 small">ƒêang t·∫£i d·ªØ li·ªáu...</div>
  </div>
</main>

<template id="emptyStateTpl">
  <div class="text-center py-5">
    <i class="bi bi-inbox fs-1 text-black-50 opacity-25"></i>
    <h6 class="text-muted mt-3">Ch∆∞a c√≥ ƒë∆°n h√†ng n√†o</h6>
    <a href="restaurant-list.html" class="btn btn-sm btn-outline-warning mt-3 px-4 rounded-pill">ƒê·∫∑t m√≥n ngay</a>
  </div>
</template>

<template id="loginRequiredTpl">
  <div class="text-center py-5">
    <i class="bi bi-shield-lock fs-1 text-muted"></i>
    <h5 class="mt-3">Vui l√≤ng ƒëƒÉng nh·∫≠p</h5>
    <p class="text-muted small">B·∫°n c·∫ßn ƒëƒÉng nh·∫≠p ƒë·ªÉ xem l·ªãch s·ª≠ ƒë∆°n h√†ng</p>
    <a href="authcus.html" class="btn btn-warning text-white px-4 rounded-pill fw-bold shadow-sm">ƒêƒÉng nh·∫≠p</a>
  </div>
</template>

<div class="modal fade" id="billModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered modal-sm">
    <div class="modal-content border-0 bg-transparent">
      <div class="modal-body p-0">
        <div id="bill-content"></div>
        <div class="text-center mt-3">
          <button class="btn btn-light rounded-pill fw-bold shadow-sm" data-bs-dismiss="modal">
            <i class="bi bi-x-circle"></i> ƒê√≥ng
          </button>
        </div>
      </div>
    </div>
  </div>
</div>

<nav class="bottom-nav" id="bottomNav">
  <div class="d-flex justify-content-around">
    <a href="restaurant-list.html" class="nav-link-custom">
      <i class="bi bi-house"></i><span>Trang ch·ªß</span>
    </a>
    <a href="tracking.html" class="nav-link-custom active">
      <i class="bi bi-receipt"></i><span>ƒê∆°n h√†ng</span>
    </a>
    <a href="profile.html" class="nav-link-custom">
      <i class="bi bi-person"></i><span>T√†i kho·∫£n</span>
    </a>
  </div>
</nav>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>

<script>
  const API_CONFIG = {
    BASE_URL: "http://localhost:8080/api",
    ORDERS_ENDPOINT: (id) => `/orders/my-orders/${id}`,
    BOOKINGS_ENDPOINT: (id) => `/bookings/user/${id}`,
    GUEST_ORDER_ENDPOINT: (id) => `/guest/orders/${id}`,
    GUEST_PAYMENT_ENDPOINT: (id) => `/guest/orders/${id}/request-payment`
  };

  // --- C·∫§U H√åNH TR·∫†NG TH√ÅI (STATUS MAP) ---
  // C·∫¨P NH·∫¨T: Th√™m thu·ªôc t√≠nh 'bg' cho t·∫•t c·∫£ tr·∫°ng th√°i ƒë·ªÉ tr√°nh l·ªói CSS
  const STATUS_MAP = {
    // BOOKING STATUS
    PENDING_BOOKING: { label: "Ch·ªù x√°c nh·∫≠n", color: "#856404", bg: "#fff3cd" },
    CONFIRMED_BOOKING: { label: "ƒê√£ x·∫øp b√†n", color: "#084298", bg: "#cfe2ff" },

    // ORDER STATUS
    WAITING_CONFIRM: { label: "Ch·ªù qu√°n nh·∫≠n", color: "#41464b", bg: "#e2e3e5", step: 1 },
    PENDING: { label: "B·∫øp ƒëang n·∫•u", color: "#b02a37", bg: "#f8d7da", step: 2 }, // ƒê·ªè nh·∫°t
    COOKING: { label: "B·∫øp ƒëang n·∫•u", color: "#b02a37", bg: "#f8d7da", step: 2 },
    DELIVERING: { label: "ƒêang giao / L√™n m√≥n", color: "#055160", bg: "#cff4fc", step: 3 }, // Xanh cyan nh·∫°t
    READY: { label: "S·∫µn s√†ng / L√™n m√≥n", color: "#055160", bg: "#cff4fc", step: 3 },
    PAYMENT_REQUEST: { label: "ƒê·ª£i thanh to√°n", color: "#3c009d", bg: "#e0cffc", step: 3 }, // T√≠m nh·∫°t

    // COMPLETED / FAILED
    COMPLETED: { label: "Ho√†n t·∫•t", color: "#0f5132", bg: "#d1e7dd", step: 4 }, // Xanh l√° nh·∫°t
    CANCELLED: { label: "ƒê√£ h·ªßy", color: "#842029", bg: "#f8d7da", step: 0 },
    REJECTED: { label: "T·ª´ ch·ªëi", color: "#842029", bg: "#f8d7da", step: 0 }
  };

  const App = {
    allItems: [],
    isGuestMode: false,

    async init() {
      const container = document.getElementById("ordersContainer");
      const urlParams = new URLSearchParams(window.location.search);

      // 1. CH·∫æ ƒê·ªò GUEST
      if (urlParams.get('mode') === 'guest') {
        this.isGuestMode = true;
        this.setupGuestMode();

        const guestOrderId = localStorage.getItem("currentGuestOrderId");
        if (!guestOrderId) {
          container.innerHTML = `<div class="text-center py-5"><h5>Kh√¥ng t√¨m th·∫•y th√¥ng tin ƒë∆°n h√†ng!</h5></div>`;
          return;
        }

        try {
          const res = await fetch(`${API_CONFIG.BASE_URL}${API_CONFIG.GUEST_ORDER_ENDPOINT(guestOrderId)}`);
          if (res.ok) {
            const order = await res.json();
            order.type = 'order';
            this.allItems = [order];

            this.renderList(this.allItems);
          } else {
            container.innerHTML = `<div class="text-center text-danger py-5">L·ªói t·∫£i ƒë∆°n h√†ng #${guestOrderId}</div>`;
          }
        } catch (e) { console.error(e); }
        return;
      }

      // 2. CH·∫æ ƒê·ªò TH√ÄNH VI√äN
      const token = localStorage.getItem("token");
      const userStr = localStorage.getItem("user");

      if (!token || !userStr) {
        container.innerHTML = document.getElementById("loginRequiredTpl").innerHTML;
        document.getElementById("mainTabs").style.display = "none";
        return;
      }

      const user = JSON.parse(userStr);
      try {
        const [ordersData, bookingsData] = await Promise.all([
          this.fetchData(API_CONFIG.ORDERS_ENDPOINT(user.id)),
          this.fetchData(API_CONFIG.BOOKINGS_ENDPOINT(user.id))
        ]);

        const orders = ordersData.map(o => ({ ...o, type: 'order' }));
        const bookings = bookingsData.map(b => ({ ...b, type: 'booking', status: b.status === 'PENDING' ? 'PENDING_BOOKING' : (b.status === 'CONFIRMED' ? 'CONFIRMED_BOOKING' : b.status) }));

        this.allItems = [...orders, ...bookings].sort((a, b) => {
          const tA = new Date(a.createdAt || a.bookingDate || 0).getTime();
          const tB = new Date(b.createdAt || b.bookingDate || 0).getTime();
          return tB - tA;
        });

        this.filter('SHIP', document.getElementById('tab-SHIP'));

      } catch (err) {
        console.error(err);
        container.innerHTML = `<div class="text-center text-danger py-5">Kh√¥ng th·ªÉ k·∫øt n·ªëi m√°y ch·ªß</div>`;
      }
    },

    setupGuestMode() {
      document.getElementById('mainTabs').style.display = 'none';
      document.getElementById('bottomNav').style.display = 'none';
      document.querySelector('.sticky-header h1').innerText = "ƒê∆°n h√†ng t·∫°i b√†n";
    },

    async fetchData(url) {
      const token = localStorage.getItem("token");
      try {
        const res = await fetch(`${API_CONFIG.BASE_URL}${url}`, {
          headers: { "Authorization": `Bearer ${token}` }
        });
        return res.ok ? await res.json() : [];
      } catch { return []; }
    },

    filter(tabName, btn) {
      if (this.isGuestMode) return;
      document.querySelectorAll(".order-tab").forEach(b => b.classList.remove("active"));
      if(btn) btn.classList.add("active");

      const container = document.getElementById("ordersContainer");
      container.innerHTML = '<div class="text-center py-5 text-muted"><div class="spinner-border spinner-border-sm"></div></div>';

      setTimeout(() => {
        let filtered = [];
        const isActive = s => !['COMPLETED', 'CANCELLED', 'REJECTED'].includes(s);
        const isHistory = s => ['COMPLETED', 'CANCELLED', 'REJECTED'].includes(s);

        if (tabName === 'SHIP') {
          filtered = this.allItems.filter(i => i.type === 'order' && (!i.tableNumber || i.tableNumber === 0) && isActive(i.status));
        } else if (tabName === 'TABLE') {
          filtered = this.allItems.filter(i => {
            const isDineInOrder = i.type === 'order' && i.tableNumber > 0 && isActive(i.status);
            const isActiveBooking = i.type === 'booking' && isActive(i.status);
            return isDineInOrder || isActiveBooking;
          });
        } else if (tabName === 'HISTORY') {
          filtered = this.allItems.filter(i => isHistory(i.status));
        }
        this.renderList(filtered);
      }, 300);
    },

    renderList(items) {
      const container = document.getElementById("ordersContainer");
      if (!items || items.length === 0) {
        container.innerHTML = document.getElementById("emptyStateTpl").innerHTML;
        return;
      }

      container.innerHTML = items.map(item => {
        if (item.type === 'booking') return this.renderBookingCard(item);
        return this.renderOrderCard(item);
      }).join('');
    },

    renderBookingCard(item) {
      const status = STATUS_MAP[item.status] || { label: item.status, color: '#000', bg: '#eee' };
      const dateStr = new Date(item.bookingDate).toLocaleDateString('vi-VN');

      let itemsHtml = "";
      if (item.items && item.items.length > 0) {
        const list = item.items.map(i => `${i.itemName || i.name} (x${i.quantity || i.qty})`).join(', ');
        itemsHtml = `<div class="booking-info-row text-primary small"><i class="bi bi-bag-check"></i> ƒê·∫∑t tr∆∞·ªõc: ${list}</div>`;
      }

      return `
                <div class="order-card border-start border-5 border-primary">
                    <div class="order-header">
                        <div class="fw-bold"><i class="bi bi-calendar-check me-2 text-primary"></i>ƒê·∫∂T B√ÄN #${item.id}</div>
                        <span class="badge" style="background-color:${status.bg}; color:${status.color}">${status.label}</span>
                    </div>
                    <div class="p-3">
                        <div class="booking-info-row"><i class="bi bi-shop"></i> <span>${item.restaurantName || item.restaurant?.name || 'Nh√† h√†ng'}</span></div>
                        <div class="booking-info-row"><i class="bi bi-clock"></i> <span>${item.bookingTime} - ${dateStr}</span></div>
                        <div class="booking-info-row"><i class="bi bi-people"></i> <span>${item.guestCount || item.peopleCount} kh√°ch</span></div>
                        ${item.tableNumber ? `<div class="booking-info-row fw-bold text-success"><i class="bi bi-geo-alt-fill"></i> <span>ƒê√£ x·∫øp b√†n s·ªë: ${item.tableNumber}</span></div>` : ''}
                        ${itemsHtml}
                        <div class="mt-2 text-muted fst-italic small border-top pt-2">
                             ${item.note ? `"${item.note}"` : 'Kh√¥ng c√≥ ghi ch√∫'}
                        </div>
                    </div>
                </div>
            `;
    },

    renderOrderCard(item) {
      // Fallback an to√†n n·∫øu status kh√¥ng t·ªìn t·∫°i
      const statusCfg = STATUS_MAP[item.status] || STATUS_MAP.PENDING;
      const isDineIn = item.tableNumber > 0;
      const isDone = ['COMPLETED', 'CANCELLED', 'REJECTED'].includes(item.status);
      const resName = item.restaurantName || item.restaurant?.name || "Nh√† h√†ng S2O";

      let progressHtml = "";
      if (!isDone) {
        const pct = ((statusCfg.step - 1) / 3) * 100;
        const step3Label = isDineIn ? "L√™n m√≥n" : "Giao h√†ng";
        const stepsHtml = `
                    <div class="step ${statusCfg.step >= 1 ? 'completed' : ''} ${statusCfg.step===1?'active':''}"><div class="step-icon"><i class="bi bi-receipt"></i></div><div class="step-label">Ch·ªù duy·ªát</div></div>
                    <div class="step ${statusCfg.step >= 2 ? 'completed' : ''} ${statusCfg.step===2?'active':''}"><div class="step-icon"><i class="bi bi-fire"></i></div><div class="step-label">B·∫øp n·∫•u</div></div>
                    <div class="step ${statusCfg.step >= 3 ? 'completed' : ''} ${statusCfg.step===3?'active':''}"><div class="step-icon"><i class="bi ${isDineIn?'bi-bell':'bi-truck'}"></i></div><div class="step-label">${step3Label}</div></div>
                    <div class="step"><div class="step-icon"><i class="bi bi-star"></i></div><div class="step-label">Ho√†n t·∫•t</div></div>
                `;
        progressHtml = `<div class="progress-track"><div class="progress-bg"></div><div class="progress-fill" style="width: ${pct}%"></div>${stepsHtml}</div>`;
      }

      const itemsList = (item.items || []).map(i =>
              `<div><b class="text-primary me-2">${i.quantity || i.qty}x</b> ${i.itemName || i.name}</div>`
      ).join('');

      let actionBtn = "";
      if (!isDone && isDineIn) {
        if (item.status === 'PAYMENT_REQUEST') {
          actionBtn = `<button class="btn btn-secondary w-100 mt-3 disabled"><i class="bi bi-hourglass-split"></i> ƒê√£ g·ªçi thanh to√°n...</button>`;
        } else {
          actionBtn = `<button onclick="App.requestPayment(${item.id})" class="btn btn-warning text-white w-100 mt-3 shadow-sm fw-bold">üõéÔ∏è G·ªåI THANH TO√ÅN</button>`;
        }
      } else if (isDone && item.status === 'COMPLETED') {
        actionBtn = `<div class="alert alert-success text-center py-2 mt-3 mb-0 fw-bold"><i class="bi bi-check-circle me-1"></i> ƒê∆°n ho√†n t·∫•t</div>`;
      } else if (isDone) {
        actionBtn = `<div class="alert alert-danger text-center py-2 mt-3 mb-0 fw-bold"><i class="bi bi-x-circle me-1"></i> ƒê√£ h·ªßy / T·ª´ ch·ªëi</div>`;
      }

      let finalPrice = item.finalPrice != null ? item.finalPrice : item.totalPrice;
      const pointsUsed = item.pointsUsed || 0;

      return `
                <div class="order-card">
                    <div class="order-header">
                        <div class="d-flex align-items-center gap-2">
                            <div class="bg-light rounded p-2 text-center" style="width:45px; height:45px">
                                <i class="bi ${isDineIn ? 'bi-shop' : 'bi-bag-check'} fs-4 text-primary"></i>
                            </div>
                            <div>
                                <div class="fw-bold text-dark">${resName}</div>
                                <div class="small text-muted">#${item.id} ‚Ä¢ ${isDineIn ? `B√†n ${item.tableNumber}` : 'Online'}</div>
                            </div>
                        </div>
                        <span class="status-badge" style="background-color:${statusCfg.bg}; color:${statusCfg.color}">${statusCfg.label}</span>
                    </div>

                    <div class="p-3 pt-0">
                        ${progressHtml}
                        <div class="mt-3 small border-start border-3 ps-2 border-light text-secondary" style="line-height:1.6">
                            ${itemsList}
                        </div>
                        ${item.note ? `<div class="bg-warning bg-opacity-10 text-warning p-2 rounded small mt-2"><i class="bi bi-pencil me-1"></i>${item.note}</div>` : ''}
                        ${actionBtn}
                    </div>

                    <div class="p-3 border-top bg-light d-flex justify-content-between align-items-center">
                        <div>
                            <div class="small text-muted">T·ªïng thanh to√°n</div>
                            <div class="fw-bold text-primary fs-5">${finalPrice.toLocaleString()}ƒë</div>
                            ${pointsUsed > 0 ? `<div class="small text-success"><i class="bi bi-gift-fill"></i> -${pointsUsed} ƒëi·ªÉm</div>` : ''}
                        </div>
                        <button class="btn btn-sm btn-outline-dark rounded-pill px-3" onclick="App.viewBill(${item.id})">
                            <i class="bi bi-receipt"></i> H√≥a ƒë∆°n
                        </button>
                    </div>
                </div>
            `;
    },

    viewBill(orderId) {
      const order = this.allItems.find(o => o.id === orderId);
      if (!order) return;

      const subTotal = order.items ? order.items.reduce((s, i) => s + (i.price||0)*(i.quantity||1), 0) : order.totalPrice;
      const discount = (order.pointsUsed || 0) * 1000;
      const final = order.finalPrice != null ? order.finalPrice : (subTotal - discount);
      const restaurantName = order.restaurantName || order.restaurant?.name || "NH√Ä H√ÄNG S2O";
      const dateStr = new Date(order.createdAt).toLocaleString('vi-VN');

      const html = `
                <div class="bill-receipt">
                    <div class="text-center mb-3">
                        <div class="fw-bold fs-5 text-uppercase">${restaurantName}</div>
                        <div class="small text-muted">M√£ ƒë∆°n: #${order.id}</div>
                        <div class="small text-muted">${dateStr}</div>
                        <div class="bill-divider"></div>
                    </div>
                    ${(order.items||[]).map(i => `
                        <div class="bill-row">
                            <span style="flex:1">${i.itemName||i.name}</span>
                            <span class="text-end" style="width:30px">x${i.quantity||i.qty}</span>
                            <span class="text-end" style="width:80px">${((i.price||0)*(i.quantity||1)).toLocaleString()}</span>
                        </div>
                    `).join('')}
                    <div class="bill-divider"></div>
                    <div class="bill-row"><span>T·∫°m t√≠nh:</span><span>${subTotal.toLocaleString()}</span></div>
                    ${discount > 0 ? `<div class="bill-row text-danger"><span>Gi·∫£m ƒëi·ªÉm:</span><span>-${discount.toLocaleString()}</span></div>` : ''}
                    <div class="bill-row fw-bold fs-5 mt-2"><span>T·ªîNG C·ªòNG:</span><span>${final.toLocaleString()}ƒë</span></div>

                    <div class="bill-divider"></div>
                    <div class="text-center mt-3 fst-italic small">
                        <div>C·∫£m ∆°n qu√Ω kh√°ch!</div>
                        <div>H·∫πn g·∫∑p l·∫°i t·∫°i ${restaurantName}</div>
                    </div>
                </div>
            `;
      document.getElementById('bill-content').innerHTML = html;
      new bootstrap.Modal(document.getElementById('billModal')).show();
    },

    async requestPayment(id) {
      if(!confirm("G·ªçi nh√¢n vi√™n thanh to√°n cho b√†n n√†y?")) return;
      const url = this.isGuestMode ? API_CONFIG.GUEST_PAYMENT_ENDPOINT(id) : `/orders/${id}/request-payment`;

      try {
        const res = await fetch(`${API_CONFIG.BASE_URL}${url}`, {
          method: 'PUT',
          headers: {
            "Content-Type": "application/json",
            "Authorization": `Bearer ${localStorage.getItem("token")}`
          }
        });
        if(res.ok) {
          alert("ƒê√£ g·ªçi nh√¢n vi√™n! Vui l√≤ng ƒë·ª£i trong gi√¢y l√°t.");
          location.reload();
        } else {
          alert("Kh√¥ng th·ªÉ g·ª≠i y√™u c·∫ßu l√∫c n√†y.");
        }
      } catch(e) { alert("L·ªói k·∫øt n·ªëi m·∫°ng"); }
    }
  };

  document.addEventListener("DOMContentLoaded", () => App.init());
</script></body>
</html>