<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S2O Partner - K√™nh ƒê·ªëi T√°c Nh√† H√†ng</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary-color: #cc5500; 
            --primary-dark: #a34500;
            --bg-color: #fff5f0;
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .auth-wrapper {
            background: white;
            width: 900px;
            max-width: 95%;
            min-height: 600px;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            display: flex;
            overflow: hidden;
        }
        
        /* C·ªôt Tr√°i: Banner Qu·∫£ng C√°o */
        .auth-banner {
            width: 45%;
            background: linear-gradient(135deg, var(--primary-color) 0%, #ff9f43 100%);
            color: white;
            padding: 40px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            position: relative;
        }
        .banner-icon {
            font-size: 3rem;
            margin-bottom: 20px;
            background: rgba(255,255,255,0.2);
            width: 80px;
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 15px;
        }
        .tick-list li {
            margin-bottom: 12px;
            font-size: 0.95rem;
        }
        .tick-list i {
            margin-right: 10px;
            color: #fff;
        }

        /* C·ªôt Ph·∫£i: Form */
        .auth-form-container {
            width: 55%;
            padding: 50px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            position: relative;
        }
        .nav-pills .nav-link {
            color: #6c757d;
            font-weight: 600;
            border-radius: 8px;
            padding: 10px 20px;
        }
        .nav-pills .nav-link.active {
            background-color: var(--primary-color);
            color: white;
        }
        .form-control {
            padding: 12px 15px;
            border-radius: 8px;
            border: 1px solid #dee2e6;
        }
        .form-control:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.25rem rgba(204, 85, 0, 0.15);
        }
        .btn-partner {
            background-color: var(--primary-color);
            color: white;
            font-weight: 600;
            padding: 12px;
            border-radius: 8px;
            width: 100%;
            border: none;
            transition: 0.3s;
        }
        .btn-partner:hover {
            background-color: var(--primary-dark);
        }
        .back-home {
            position: absolute;
            top: 20px;
            right: 20px;
            text-decoration: none;
            color: #adb5bd;
            font-size: 0.9rem;
        }
        .back-home:hover { color: var(--primary-color); }

        @media (max-width: 768px) {
            .auth-wrapper { flex-direction: column; height: auto; }
            .auth-banner { display: none; }
            .auth-form-container { width: 100%; padding: 30px; }
        }
    </style>
</head>
<body>

<div class="auth-wrapper">
    <div class="auth-banner">
        <div class="banner-icon"><i class="fas fa-chart-line"></i></div>
        <h2 class="fw-bold mb-3">S2O PARTNER</h2>
        <p class="opacity-75 mb-4">Gi·∫£i ph√°p qu·∫£n l√Ω nh√† h√†ng th√¥ng minh, gi√∫p b·∫°n tƒÉng doanh thu v√† t·ªëi ∆∞u v·∫≠n h√†nh.</p>
        
        <ul class="list-unstyled tick-list">
            <li><i class="fas fa-check-circle"></i> Qu·∫£n l√Ω Menu & Gi√° b√°n linh ho·∫°t</li>
            <li><i class="fas fa-check-circle"></i> Theo d√µi doanh thu Real-time</li>
            <li><i class="fas fa-check-circle"></i> T·ª± ƒë·ªông in h√≥a ƒë∆°n xu·ªëng b·∫øp</li>
            <li><i class="fas fa-check-circle"></i> Kh√¥ng ph√≠ c√†i ƒë·∫∑t ban ƒë·∫ßu</li>
        </ul>
        
        <div class="mt-auto pt-4 border-top border-white border-opacity-25">
            <small class="d-block mb-1">ƒê√£ c√≥ h∆°n 500+ ƒë·ªëi t√°c tin d√πng</small>
            <div class="d-flex gap-2">
                <i class="fas fa-star text-warning"></i>
                <i class="fas fa-star text-warning"></i>
                <i class="fas fa-star text-warning"></i>
                <i class="fas fa-star text-warning"></i>
                <i class="fas fa-star text-warning"></i>
            </div>
        </div>
    </div>

    <div class="auth-form-container">
        <a href="authcus.html" class="back-home"><i class="fas fa-arrow-left"></i> Quay l·∫°i</a>

        <div class="text-center mb-4">
            <h3 class="fw-bold text-dark">K√™nh ƒê·ªëi T√°c</h3>
            <p class="text-muted small">D√†nh cho Ch·ªß Nh√† H√†ng & Qu·∫£n L√Ω</p>
        </div>

        <ul class="nav nav-pills nav-fill mb-4" id="pills-tab" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="pills-login-tab" data-bs-toggle="pill" data-bs-target="#pills-login" type="button">ƒêƒÉng nh·∫≠p</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="pills-register-tab" data-bs-toggle="pill" data-bs-target="#pills-register" type="button">ƒêƒÉng k√Ω M·ªü Qu√°n</button>
            </li>
        </ul>

        <div class="tab-content" id="pills-tabContent">
            
            <div class="tab-pane fade show active" id="pills-login">
                <form onsubmit="handlePartnerLogin(event)">
                    <div class="mb-3">
                        <label class="form-label small fw-bold">T√™n ƒëƒÉng nh·∫≠p</label>
                        <input type="text" id="login-user" class="form-control" placeholder="Username qu·∫£n l√Ω" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label small fw-bold">M·∫≠t kh·∫©u</label>
                        <input type="password" id="login-pass" class="form-control" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                    </div>
                    <div class="d-flex justify-content-between mb-4">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="remember">
                            <label class="form-check-label small" for="remember">Ghi nh·ªõ</label>
                        </div>
                        <a href="#" class="small text-decoration-none" style="color:var(--primary-color)">Qu√™n m·∫≠t kh·∫©u?</a>
                    </div>
                    <button type="submit" class="btn-partner">Truy C·∫≠p Qu·∫£n L√Ω</button>
                </form>
            </div>

            <div class="tab-pane fade" id="pills-register">
                <form onsubmit="handlePartnerRegister(event)">
                    <h6 class="text-muted small fw-bold mb-3 text-uppercase"><i class="fas fa-store me-1"></i> Th√¥ng tin qu√°n</h6>
                    
                    <div class="mb-2">
                        <input type="text" id="reg-res-name" class="form-control" placeholder="T√™n Nh√† H√†ng (*)" required>
                    </div>
                    <div class="mb-3">
                        <input type="text" id="reg-res-addr" class="form-control" placeholder="ƒê·ªãa ch·ªâ kinh doanh (*)" required>
                    </div>

                    <h6 class="text-muted small fw-bold mb-3 text-uppercase border-top pt-3"><i class="fas fa-user-shield me-1"></i> T√†i kho·∫£n qu·∫£n tr·ªã</h6>
                    <div class="row g-2 mb-2">
                        <div class="col-6">
                            <input type="text" id="reg-fullname" class="form-control" placeholder="H·ªç t√™n ch·ªß qu√°n" required>
                        </div>
                        <div class="col-6">
                            <input type="text" id="reg-user" class="form-control" placeholder="T√™n ƒëƒÉng nh·∫≠p" required>
                        </div>
                    </div>
                    <div class="mb-4">
                        <input type="password" id="reg-pass" class="form-control" placeholder="M·∫≠t kh·∫©u" required>
                    </div>

                    <button type="submit" class="btn-partner">ƒêƒÉng K√Ω ƒê·ªëi T√°c</button>
                    <p class="text-center small mt-3 text-muted">
                        B·∫±ng vi·ªác ƒëƒÉng k√Ω, b·∫°n ƒë·ªìng √Ω v·ªõi <a href="#" class="text-dark fw-bold">ƒêi·ªÅu kho·∫£n h·ª£p t√°c</a> c·ªßa S2O.
                    </p>
                </form>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
    const API_BASE = "http://localhost:8080/api/auth";

    // 1. X·ª≠ l√Ω ƒêƒÉng K√Ω (Partner) - C√≥ c·∫£nh b√°o ch·ªù duy·ªát
    async function handlePartnerRegister(e) {
        e.preventDefault();
        
        const body = {
            username: document.getElementById('reg-user').value,
            password: document.getElementById('reg-pass').value,
            fullName: document.getElementById('reg-fullname').value,
            
            // Vai tr√≤: MANAGER (Ch·ªß qu√°n)
            role: "MANAGER", 
            
            // Th√¥ng tin t·∫°o qu√°n (ID s·∫Ω do Backend t·ª± sinh, kh√¥ng c·∫ßn g·ª≠i)
            restaurantId: null, 
            restaurantName: document.getElementById('reg-res-name').value,
            address: document.getElementById('reg-res-addr').value
        };

        try {
            const res = await fetch(`${API_BASE}/register`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(body)
            });

            if (res.ok) {
                // üëá TH√îNG B√ÅO QUAN TR·ªåNG CHO NG∆Ø·ªúI D√ôNG
                alert("ƒêƒÉng k√Ω th√†nh c√¥ng!\n\nH·ªá th·ªëng ƒë√£ ghi nh·∫≠n y√™u c·∫ßu m·ªü qu√°n.\nVui l√≤ng CH·ªú ADMIN PH√ä DUY·ªÜT tr∆∞·ªõc khi ƒëƒÉng nh·∫≠p.");
                
                // Chuy·ªÉn sang tab ƒëƒÉng nh·∫≠p ƒë·ªÉ h·ªç th·∫•y ti·ªán
                document.getElementById("pills-login-tab").click();
                document.getElementById("login-user").value = body.username;
            } else {
                const text = await res.text();
                alert("ƒêƒÉng k√Ω th·∫•t b·∫°i: " + text);
            }
        } catch (err) {
            alert("L·ªói k·∫øt n·ªëi Server! Vui l√≤ng th·ª≠ l·∫°i.");
            console.error(err);
        }
    }

    // 2. X·ª≠ l√Ω ƒêƒÉng Nh·∫≠p
    async function handlePartnerLogin(e) {
        e.preventDefault();
        const u = document.getElementById('login-user').value;
        const p = document.getElementById('login-pass').value;

        try {
            const res = await fetch(`${API_BASE}/login`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ username: u, password: p })
            });

            if (res.ok) {
                const data = await res.json();

                if (data.role === 'MANAGER' || data.role === 'ADMIN') {
                    // L∆∞u Token
                    localStorage.setItem("token", data.token); 
                    localStorage.setItem("user", JSON.stringify(data));
                    
                    // L∆∞u ri√™ng ID qu√°n ƒë·ªÉ ti·ªán truy xu·∫•t
                    if(data.restaurantId) localStorage.setItem("partner_tenant_id", data.restaurantId);
                    
                    window.location.href = "partner-dashboard.html";
                } else {
                    alert("T√†i kho·∫£n n√†y kh√¥ng ph·∫£i l√† ƒê·ªëi t√°c Nh√† h√†ng!");
                }
            } else {
                // Backend tr·∫£ v·ªÅ l·ªói c·ª• th·ªÉ (v√≠ d·ª•: "T√†i kho·∫£n ƒëang ch·ªù duy·ªát")
                const errorText = await res.text();
                alert("ƒêƒÉng nh·∫≠p th·∫•t b·∫°i:\n" + errorText);
            }
        } catch (err) {
            alert("L·ªói k·∫øt n·ªëi Server!");
        }
    }
</script>

</body>
</html>